{{define "title"}} Search {{end}} {{define "main"}}
<main class="container">
  <section class="search-results">
    <h1>Search Results</h1>
    <p class="subtitle">Showing results for "{{.SearchQuery}}"</p>

    <div class="search-layout">
      <aside class="filters-sidebar">
        <h3>Filters</h3>
        <form method="GET" action="/search">
          <input type="hidden" name="q" value="{{.SearchQuery}}">

          <div class="filter-group">
            <h4>Category</h4>
            <select name="category" class="filter-select" onchange="this.form.submit()">
              <option value="">All Categories</option>
              <option value="Fiction" {{if eq .SearchCategory "Fiction"}}selected{{end}}>Fiction</option>
              <option value="Non-Fiction" {{if eq .SearchCategory "Non-Fiction"}}selected{{end}}>Non-Fiction</option>
              <option value="Science" {{if eq .SearchCategory "Science"}}selected{{end}}>Science</option>
              <option value="History" {{if eq .SearchCategory "History"}}selected{{end}}>History</option>
              <option value="Romance" {{if eq .SearchCategory "Romance"}}selected{{end}}>Romance</option>
              <option value="Classic" {{if eq .SearchCategory "Classic"}}selected{{end}}>Classic</option>
            </select>
          </div>

          <div class="filter-group">
            <h4>Availability</h4>
            <select name="availability" class="filter-select" onchange="this.form.submit()">
              <option value="">All Books</option>
              <option value="Available" {{if eq .SearchAvailability "Available"}}selected{{end}}>Available</option>
              <option value="Borrowed" {{if eq .SearchAvailability "Borrowed"}}selected{{end}}>Borrowed</option>
            </select>
          </div>

          <div class="filter-group">
            <h4>Sort By</h4>
            <select name="sort" class="filter-select" onchange="this.form.submit()">
              <option value="">Relevance</option>
              <option value="Title (A-Z)" {{if eq .SearchSort "Title (A-Z)"}}selected{{end}}>Title (A-Z)</option>
              <option value="Title (Z-A)" {{if eq .SearchSort "Title (Z-A)"}}selected{{end}}>Title (Z-A)</option>
              <option value="Author (A-Z)" {{if eq .SearchSort "Author (A-Z)"}}selected{{end}}>Author (A-Z)</option>
              <option value="Newest First" {{if eq .SearchSort "Newest First"}}selected{{end}}>Newest First</option>
            </select>
          </div>

          <button type="button" class="btn btn-secondary btn-block" onclick="clearFilters()">Clear Filters</button>
        </form>
      </aside>

      <div class="search-content">
        <p class="results-count">{{len .Books}} books found</p>

        <div class="books-grid">
          {{range .Books}}
          <div class="book-card">
            <div class="book-image">
              <img src="{{.CoverImage}}" alt="{{.Title}}" />
              {{if gt .CopiesAvailable 0}}
              <span class="status-badge available">Available</span>
              {{else}}
              <span class="status-badge borrowed">Borrowed</span>
              {{end}}
            </div>
            <div class="book-info">
              <span class="book-category">{{index .Genres 0}}</span>
              <h3 class="book-title">{{.Title}}</h3>
              <p class="book-author">by {{.Author}}</p>
              <a href="/books/{{.ID}}" class="btn btn-primary">View Details</a>
            </div>
          </div>
          {{else}}
          <p>No books found.</p>
          {{end}}
        </div>
      </div>
    </div>
  </section>
</main>

<script>
function clearFilters() {
  const form = document.querySelector('.filters-sidebar form');
  form.querySelector('select[name="category"]').value = '';
  form.querySelector('select[name="availability"]').value = '';
  form.querySelector('select[name="sort"]').value = '';
  form.querySelector('input[name="q"]').value = '';
  form.submit();
}
</script>
{{end}}
